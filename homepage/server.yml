- name: Server
  columns:
    - size: small
      widgets:
        - type: extension
          title: Storage
          url: http://glance-disk-monitor:8888/disk-status
          allow-potentially-dangerous-html: true
          cache: 5m

        - type: custom-api
          cache: 1h
          title: Internet Speed
          title-url: https://speedtest.shubhamprasad.me
          url: http://192.168.1.105:8080/api/v1/results/latest
          headers:
            Authorization: Bearer ${SPEEDTEST_API_TOKEN}
            Accept: application/json
          subrequests:
            stats:
              url: http://192.168.1.105:8080/api/v1/stats
              headers:
                Authorization: Bearer ${SPEEDTEST_API_TOKEN}
                Accept: application/json
          options:
            showPercentageDiff: true
          template: |
            {{ $showPercentage := .Options.BoolOr "showPercentageDiff" true }}

            {{ $stats := .Subrequest "stats" }}
            {{/* Check if subrequest failed */}}
            {{ if not $stats }}
              <div>Error fetching stats</div>
            {{ else }}

            <div class="flex justify-between text-center margin-block-3">
              <div>
                  {{ $downloadChange := percentChange ($stats.JSON.Float "data.download.avg_bits") (.JSON.Float "data.download_bits")
                  }}
                  {{ if $showPercentage }}
                  <div
                  class="size-small {{ if gt $downloadChange 0.0 }}color-positive{{ else if lt $downloadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                  style="display: inline-flex; align-items: center;">
                  {{ $downloadChange | printf "%+.1f%%" }}
                  {{ if gt $downloadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd" d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z" clip-rule="evenodd" />
                  </svg>
                  {{ else if lt $downloadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd" d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                  {{ end }}
                  </div>
                  {{ end }}
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.download_bits" | mul 0.000001 | printf "%.1f" }}</div>
                  <div class="size-h6">DOWNLOAD</div>
              </div>
              <div>
                  {{ $uploadChange := percentChange ($stats.JSON.Float "data.upload.avg_bits") (.JSON.Float "data.upload_bits") }}
                  {{ if $showPercentage }}
                  <div
                  class="size-small {{ if gt $uploadChange 0.0 }}color-positive{{ else if lt $uploadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                  style="display: inline-flex; align-items: center;">
                  {{ $uploadChange | printf "%+.1f%%" }}
                  {{ if gt $uploadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd" d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z" clip-rule="evenodd" />
                  </svg>
                  {{ else if lt $uploadChange 0.0 }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                      style="height: 1em; margin-left: 0.25em;" class="size-4">
                      <path fill-rule="evenodd" d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                  {{ end }}
                  </div>
                  {{ end }}
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.upload_bits" | mul 0.000001 | printf "%.1f" }}</div>
                  <div class="size-h6">UPLOAD</div>
              </div>
              <div>
                  <div class="color-highlight size-h3">{{ .JSON.Float "data.ping.latency" | printf "%.0f" }}</div>
                  <div class="size-h6">PING</div>
              </div>
            </div>
            {{ end }}

        - type: custom-api
          title: qBittorrent
          title-url: https://qbittorrent.shubhamprasad.me
          cache: 10s
          options:
            view: "detailed"
            mode: "default"
          subrequests:
            transfer:
              url: https://qbittorrent.shubhamprasad.me/api/v2/transfer/info
            seeding:
              url: https://qbittorrent.shubhamprasad.me/api/v2/torrents/info
              parameters:
                filter: seeding
            leeching:
              url: https://qbittorrent.shubhamprasad.me/api/v2/torrents/info
              parameters:
                filter: downloading
          template: |
            {{ $transfer := .Subrequest "transfer" }}
            {{ $seeding := .Subrequest "seeding" }}
            {{ $leeching := .Subrequest "leeching" }}

            {{ if and (eq $transfer.Response.StatusCode 200) (eq $seeding.Response.StatusCode 200) (eq $leeching.Response.StatusCode 200) }}
              {{ $isDetailed := eq (.Options.StringOr "view" "detailed") "detailed" }}
              {{ $mode := .Options.StringOr "mode" "default" }}

              {{ if $isDetailed }}
              <div class="list" style="--list-gap: 15px;">
                <div class="flex justify-between text-center">
                  <div>
                    {{ $dlSpeed := $transfer.JSON.Float "dl_info_speed" }}
                    {{ if eq $mode "upload" }}
                      <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}</div>
                    {{ else }}
                      {{ if lt $dlSpeed 1048576.0 }}
                        <div class="color-highlight size-h3">{{ printf "%.0f KiB/s" (div $dlSpeed 1024.0) }}</div>
                      {{ else }}
                        <div class="color-highlight size-h3">{{ printf "%.1f MiB/s" (div $dlSpeed 1048576.0) }}</div>
                      {{ end }}
                    {{ end }}
                    <div class="size-h6">DOWNLOADING</div>
                  </div>

                  {{ if eq $mode "upload" }}
                  <div>
                    {{ $ulSpeed := $transfer.JSON.Float "up_info_speed" }}
                    <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $ulSpeed 1000000.0) }}</div>
                    <div class="size-h6">UPLOADING</div>
                  </div>
                  {{ end }}

                  <div>
                    <div class="color-highlight size-h3">{{ len ($seeding.JSON.Array "") }}</div>
                    <div class="size-h6">SEEDING</div>
                  </div>

                  {{ if eq $mode "default" }}
                  <div>
                    <div class="color-highlight size-h3">{{ len ($leeching.JSON.Array "") }}</div>
                    <div class="size-h6">LEECHING</div>
                  </div>
                  {{ end }}
                </div>

                {{ $downloadingTorrents := $leeching.JSON.Array "" }}
                {{ if gt (len $downloadingTorrents) 0 }}
                  <div style="margin-top: 15px;">
                    <ul class="list collapsible-container" data-collapse-after="0" style="--list-gap: 15px;">
                      {{ range $t := $downloadingTorrents }}
                        {{ $state := $t.String "state" }}
                        {{ $icon := "?" }}
                        {{ if ge ($t.Int "completed") ($t.Int "size") }}{{ $icon = "✔" }}
                        {{ else if eq $state "downloading" "forcedDL" }}{{ $icon = "↓" }}
                        {{ else if eq $state "pausedDL" "stoppedDL" "pausedUP" "stalledDL" "stalledUP" "queuedDL" "queuedUP" }}{{ $icon = "❚❚" }}
                        {{ else if eq $state "error" "missingFiles" }}{{ $icon = "!" }}
                        {{ else if eq $state "checkingDL" "checkingUP" "allocating" }}{{ $icon = "…" }}
                        {{ else if eq $state "checkingResumeData" }}{{ $icon = "⟳" }}
                        {{ end }}

                        <li class="flex items-center" style="gap: 10px;">
                          <div class="size-h4" style="flex-shrink: 0;">{{ $icon }}</div>
                          <div style="flex-grow: 1; min-width: 0;">
                            <div class="text-truncate color-highlight">{{ $t.String "name" }}</div>
                            <div title="{{ $t.Float "progress" | mul 100 | printf "%.1f" }}%" style="background: rgba(128, 128, 128, 0.2); border-radius: 5px; height: 6px; margin-top: 5px; overflow: hidden;">
                              <div style="width: {{ $t.Float "progress" | mul 100 }}%; background-color: var(--color-positive); height: 100%; border-radius: 5px;"></div>
                            </div>
                          </div>
                          <div style="flex-shrink: 0; text-align: right; width: 80px;">
                            {{ $dlSpeed := $t.Float "dlspeed" }}
                            <div class="size-sm color-paragraph">
                              {{ if eq $mode "upload" }}
                                {{ if lt $dlSpeed 1000.0 }}--{{ else }}{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}{{ end }}
                              {{ else }}
                                {{ if lt $dlSpeed 1024.0 }}--{{ else if lt $dlSpeed 1048576.0 }}{{ printf "%.0f KiB/s" (div $dlSpeed 1024.0) }}{{ else }}{{ printf "%.1f MiB/s" (div $dlSpeed 1048576.0) }}{{ end }}
                              {{ end }}
                            </div>
                            {{ $eta := $t.Int "eta" }}
                            <div class="size-sm color-paragraph">
                              {{ if eq $eta 8640000 }}∞
                              {{ else if gt $eta 3600 }}{{ printf "%dh %dm" (div $eta 3600) (mod (div $eta 60) 60) }}
                              {{ else if gt $eta 0 }}{{ printf "%dm" (div $eta 60) }}
                              {{ else }}--{{ end }}
                            </div>
                          </div>
                        </li>
                      {{ end }}
                    </ul>
                  </div>
                {{ end }}
              </div>

              {{ else }}
              <div class="flex justify-between text-center">
                <div>
                  {{ $dlSpeed := $transfer.JSON.Float "dl_info_speed" }}
                  <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}</div>
                  <div class="size-h6">DOWNLOADING</div>
                </div>
                {{ if eq $mode "upload" }}
                <div>
                  {{ $ulSpeed := $transfer.JSON.Float "up_info_speed" }}
                  <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $ulSpeed 1000000.0) }}</div>
                  <div class="size-h6">UPLOADING</div>
                </div>
                {{ end }}
                <div>
                  <div class="color-highlight size-h3">{{ len ($seeding.JSON.Array "") }}</div>
                  <div class="size-h6">SEEDING</div>
                </div>
                {{ if eq $mode "default" }}
                <div>
                  <div class="color-highlight size-h3">{{ len ($leeching.JSON.Array "") }}</div>
                  <div class="size-h6">LEECHING</div>
                </div>
                {{ end }}
              </div>
              {{ end }}

            {{ else }}
              <div class="color-negative text-center">
                <p>Error fetching qBittorrent data.</p>
                <p class="size-sm">Check URL and authentication bypass settings.</p>
              </div>
            {{ end }}

        - type: custom-api
          title: Immich stats
          title-url: https://photos.shubhamprasad.me
          cache: 1d
          url: https://photos.shubhamprasad.me/api/server/statistics
          headers:
            x-api-key: ${IMMICH_API_KEY}
            Accept: application/json
          template: |
            <div class="flex justify-between text-center">
              <div>
                  <div class="color-highlight size-h3">{{ .JSON.Int "photos" | formatNumber }}</div>
                  <div class="size-h6">PHOTOS</div>
              </div>
              <div>
                  <div class="color-highlight size-h3">{{ .JSON.Int "videos" | formatNumber }}</div>
                  <div class="size-h6">VIDEOS</div>
              </div>
              <div>
                  <div class="color-highlight size-h3">{{ div (.JSON.Int "usage" | toFloat) 1073741824 | toInt | formatNumber }}GB</div>
                  <div class="size-h6">USAGE</div>
              </div>
            </div>

        - type: custom-api
          title: Minecraft
          url: https://api.mcstatus.io/v2/status/java/hi-notice.gl.joinmc.link
          cache: 2m
          template: |
            <div style="display:flex; align-items:center; gap:12px;">
              <div style="width:40px; height:40px; flex-shrink:0;  border-radius:4px; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                {{ if .JSON.Bool "online" }}
                  <img src="{{ .JSON.String "icon" | safeURL }}" width="64" height="64" style="object-fit:contain;">
                {{ else }}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style="width:32px; height:32px; opacity:0.5;">
                    <path fill-rule="evenodd" d="M1 5.25A2.25 2.25 0 0 1 3.25 3h13.5A2.25 2.25 0 0 1 19 5.25v9.5A2.25 2.25 0 0 1 16.75 17H3.25A2.25 2.25 0 0 1 1 14.75v-9.5Zm1.5 5.81v3.69c0 .414.336.75.75.75h13.5a.75.75 0 0 0 .75-.75v-2.69l-2.22-2.219a.75.75 0 0 0-1.06 0l-1.91 1.909.47.47a.75.75 0 1 1-1.06 1.06L6.53 8.091a.75.75 0 0 0-1.06 0l-2.97 2.97ZM12 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" clip-rule="evenodd" />
                  </svg>
                {{ end }}
              </div>

              <div style="flex-grow:1; min-width:0;">
                <a class="size-h4 block text-truncate color-highlight">
                  {{ .JSON.String "host" }}
                  {{ if .JSON.Bool "online" }}
                  <span
                    style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-positive); display: inline-block; vertical-align: middle;"
                    data-popover-type="text"
                    data-popover-text="Online"
                  ></span>
                  {{ else }}
                  <span
                    style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-negative); display: inline-block; vertical-align: middle;"
                    data-popover-type="text"
                    data-popover-text="Offline"
                  ></span>
                  {{ end }}
                </a>

                <ul class="list-horizontal-text">
                  <li>
                    {{ if .JSON.Bool "online" }}
                    <span>{{ .JSON.String "version.name_clean" }}</span>
                    {{ else }}
                    <span>Offline</span>
                    {{ end }}
                  </li>
                  {{ if .JSON.Bool "online" }}
                  <li data-popover-type="html">
                    <div data-popover-html>
                      {{ range .JSON.Array "players.list" }}{{ .String "name_clean" }}<br>{{ end }}
                    </div>
                  </li>
                  {{ end }}
                </ul>
              </div>
            </div>

        - type: custom-api
          title: Tailscale Devices
          title-url: https://login.tailscale.com/admin/machines
          url: https://api.tailscale.com/api/v2/tailnet/-/devices
          headers:
            Authorization: Bearer ${TAILSCALE_API_KEY}
          cache: 10m
          options:
            collapseAfter: 5
          template: |
            <ul class="list list-gap-10 collapsible-container" data-collapse-after="{{ .Options.IntOr "collapseAfter" 3 }}">
              {{ range .JSON.Array "devices" }}
              <li>
                <div class="flex items-center gap-10">
                  <div class="grow">
                    <span class="size-h4 block text-truncate color-primary">
                      {{ findMatch "^([^.]+)" (.String "name") }}
                    </span>
                    <div class="flex items-center gap-4">
                      {{ if .Bool "updateAvailable" }}
                      <span style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-primary); display: inline-block;"></span>
                      {{ end }}

                      {{ $lastSeen := .String "lastSeen" | parseTime "rfc3339" }}
                      {{ if not ($lastSeen.After (offsetNow "-10s")) }}
                      <span style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-negative); display: inline-block;"></span>
                      {{ end }}
                    </div>
                  </div>
                </div>
                <div>
                  <ul class="list-horizontal-text">
                    <li>{{ .String "os" }}</li>
                    <li>{{ .String "user" }}</li>
                  </ul>
                  <div style="font-size: 0.8em; opacity: 0.7;">
                    {{ .String "addresses.0" }}
                  </div>
                </div>
              </li>
              {{ end }}
            </ul>

    - size: full
      widgets:
        - type: group
          widgets:
            - type: custom-api
              title: Day
              body-type: string
              skip-json-validation: true
              cache: 1s
              template: |
                {{ $localTime := now }}
                {{ $secondsPerDay := 86400 }}
                {{ $elapsedSeconds := add (mul $localTime.Hour 3600) (mul $localTime.Minute 60) | add $localTime.Second }}
                {{ $dayProgress := div (mul $elapsedSeconds 100.0) $secondsPerDay }}

                {{ $gradient := "" }}
                {{ if lt $dayProgress 10.0 }}
                  {{ $gradient = "#70a1ff" }}
                {{ else if lt $dayProgress 25.0 }}
                  {{ $gradient = "#ff6b6b, #70a1ff" }}
                {{ else if lt $dayProgress 50.0 }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df" }}
                {{ else }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df, #70a1ff" }}
                {{ end }}

                <div style="font-family: sans-serif; text-align: center;">
                  <div style="width: 100%; height: 12px; background: #23262F; border:1px solid gray; border-radius: 10px; overflow: hidden;">
                    <div style="height: 100%; width: {{ $dayProgress }}%; background: linear-gradient(90deg, {{ $gradient }});"></div>
                  </div>
                  <div class="size-h1" style="margin-top: 6px;">{{ printf "%.2f" $dayProgress }}% of the day has passed</div>
                </div>

            - type: custom-api
              title: Month
              body-type: string
              skip-json-validation: true
              cache: 1s
              template: |
                {{ $localTime := now }}

                {{ $month := $localTime.Month }}
                {{ $dayOfMonth := $localTime.Day }}

                {{ $secondsToday := add (mul $localTime.Hour 3600) (mul $localTime.Minute 60) | add $localTime.Second }}
                {{ $fractionOfDay := div $secondsToday 86400.0 }}

                {{ $daysInMonth := 31 }}
                {{ if eq $month 2 }} {{ $daysInMonth = 28 }} {{ end }}
                {{ if or (eq $month 4) (eq $month 6) (eq $month 9) (eq $month 11) }} {{ $daysInMonth = 30 }} {{ end }}

                {{ $daysElapsed := add (sub $dayOfMonth 1) $fractionOfDay }}
                {{ $monthProgress := mul (div $daysElapsed $daysInMonth) 100.0 }}

                {{ $gradient := "" }}
                {{ if lt $monthProgress 10.0 }}
                  {{ $gradient = "#70a1ff" }}
                {{ else if lt $monthProgress 25.0 }}
                  {{ $gradient = "#ff6b6b, #70a1ff" }}
                {{ else if lt $monthProgress 50.0 }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df" }}
                {{ else }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df, #70a1ff" }}
                {{ end }}

                <div style="font-family: sans-serif; text-align: center;">
                  <div style="width: 100%; height: 12px; background: #23262F; border:1px solid gray; border-radius: 10px; overflow: hidden;">
                    <div style="height: 100%; width: {{ $monthProgress }}%; background: linear-gradient(90deg, {{ $gradient }});"></div>
                  </div>
                  <div class="size-h1" style="margin-top: 6px;">{{ printf "%.2f" $monthProgress }}% of the month has passed</div>
                </div>

            - type: custom-api
              title: Year
              body-type: string
              skip-json-validation: true
              cache: 1s
              template: |
                {{ $localTime := now }}
                
                {{ $secondsToday := add (mul $localTime.Hour 3600) (mul $localTime.Minute 60) | add $localTime.Second }}
                {{ $dayOfYear := $localTime.YearDay }}
                {{ $secondsElapsed := add (mul (sub $dayOfYear 1) 86400) $secondsToday }}

                {{ $totalSecondsInYear := mul 365 86400 }}
                {{ $yearProgress := div (mul $secondsElapsed 100.0) $totalSecondsInYear }}

                {{ $gradient := "" }}
                {{ if lt $yearProgress 10.0 }}
                  {{ $gradient = "#70a1ff" }}
                {{ else if lt $yearProgress 25.0 }}
                  {{ $gradient = "#ff6b6b, #70a1ff" }}
                {{ else if lt $yearProgress 50.0 }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df" }}
                {{ else }}
                  {{ $gradient = "#ff6b6b, #f8e71c, #7ed6df, #70a1ff" }}
                {{ end }}

                <div style="font-family: sans-serif; text-align: center;">
                  <div style="width: 100%; height: 12px; background: #23262F; border:1px solid gray; border-radius: 10px; overflow: hidden;">
                    <div style="height: 100%; width: {{ $yearProgress }}%; background: linear-gradient(90deg, {{ $gradient }});"></div>
                  </div>
                  <div class="size-h1" style="margin-top: 6px;">{{ printf "%.2f" $yearProgress }}% of the year has passed</div>
                </div>

        - type: monitor
          title: Frontend & Media
          sites:
            - title: Jellyfin
              url: https://jellyfin.shubhamprasad.me
              icon: si:jellyfin
            - title: Immich
              url: https://photos.shubhamprasad.me
              icon: si:immich
            - title: Nextcloud
              url: https://nextcloud.shubhamprasad.me
              icon: si:nextcloud
            - title: Jellyseerr
              url: https://jellyseerr.shubhamprasad.me
              icon: mdi:jellyfish
            - title: Booklore
              url: https://books.shubhamprasad.me
              icon: si:audiobookshelf
            - title: Navidrome
              url: https://music.shubhamprasad.me
              icon: auto-invert https://cdn.jsdelivr.net/gh/selfhst/icons@main/png/navidrome-dark.png
            - title: Home Assistant
              url: https://home.shubhamprasad.me
              icon: si:homeassistant
            - title: BentoPDF
              url: https://pdf.shubhamprasad.me
              icon: si:adobeacrobatreader

        - type: monitor
          title: Backend & Downloads
          sites:
            - title: Sonarr
              url: https://sonarr.shubhamprasad.me
              icon: si:sonarr
            - title: Radarr
              url: https://radarr.shubhamprasad.me
              icon: si:radarr
            - title: Lidarr
              url: https://lidarr.shubhamprasad.me
              icon: mdi:music
            - title: Bazarr
              url: https://bazarr.shubhamprasad.me
              icon: mdi:subtitles
            - title: Prowlarr
              url: https://prowlarr.shubhamprasad.me
              icon: auto-invert https://cdn.jsdelivr.net/gh/selfhst/icons@main/png/prowlarr-dark.png
            - title: Jackett
              url: https://jackett.shubhamprasad.me
              icon: auto-invert https://cdn.jsdelivr.net/gh/selfhst/icons@main/png/jackett-dark.png
            - title: Qbittorrent
              url: https://qbittorrent.shubhamprasad.me
              icon: si:qbittorrent
            - title: Slskd
              url: https://slskd.shubhamprasad.me
              icon: auto-invert https://cdn.jsdelivr.net/gh/selfhst/icons@main/png/slskd-dark.png
            - title: Youtube DL
              url: https://ytdlp.shubhamprasad.me
              icon: si:youtube

        - type: monitor
          title: System & Tools
          sites:
            - title: Proxmox
              url: https://proxmox.shubhamprasad.me
              icon: si:proxmox
            - title: Nginx Proxy Manager
              url: https://npm.shubhamprasad.me
              icon: si:nginxproxymanager
            - title: Beszel
              url: https://monitoring.shubhamprasad.me
              icon: auto-invert https://cdn.jsdelivr.net/gh/selfhst/icons@main/png/beszel-dark.png
            - title: WUD
              url: https://wud.shubhamprasad.me
              icon: si:docker
            - title: Speedtest
              url: https://speedtest.shubhamprasad.me
              icon: si:speedtest

        - type: bookmarks
          title: Quick Access
          groups:
            - links:
                - title: Cloudflare Dashboard
                  url: https://dash.cloudflare.com/
                  icon: si:cloudflare
                - title: Samba Share
                  url: smb://192.168.1.103
                  icon: si:windows11

    - size: small
      widgets:
        - type: custom-api
          title: Proxmox-VE Stats
          title-url: https://proxmox.shubhamprasad.me
          cache: 1m
          url: https://${PROXMOX_URL}/api2/json/cluster/resources
          allow-insecure: true
          headers:
            Accept: application/json
            Authorization: PVEAPIToken=${PROXMOX_API_TOKEN}
          template: |
            <div class="flex flex-column gap-5">
              <div class="flex justify-between text-center">
                <div>
                  {{ $nodes_online := len (.JSON.Array "data.#(type==\"node\")#|#(status==\"online\")#") }}
                  {{ $nodes_total := len (.JSON.Array "data.#(type==\"node\")#") }}
                  <div class="color-highlight size-h3">{{ $nodes_online }}/{{ $nodes_total }}</div>
                  <div class="size-h5 uppercase">Node</div>
                </div>
                <div>
                  {{ $lxc_running := len (.JSON.Array "data.#(type==\"lxc\")#|#(status==\"running\")#|#(template==0)#") }}
                  {{ $lxc_total := len (.JSON.Array "data.#(type==\"lxc\")#|#(template==0)#") }}
                  <div class="color-highlight size-h3">{{ $lxc_running }}/{{ $lxc_total }}</div>
                  <div class="size-h5 uppercase">LXC</div>
                </div>
                <div>
                  {{ $qemu_running := len (.JSON.Array "data.#(type==\"qemu\")#|#(status==\"running\")#|#(template==0)#") }}
                  {{ $qemu_total := len (.JSON.Array "data.#(type==\"qemu\")#|#(template==0)#") }}
                  <div class="color-highlight size-h3">{{ $qemu_running }}/{{ $qemu_total }}</div>
                  <div class="size-h5 uppercase">VM</div>
                </div>
                <div>
                    {{ $storage_available := len (.JSON.Array "data.#(type==\"storage\")#|#(status==\"available\")#") }}
                    {{ $storage_total := len (.JSON.Array "data.#(type==\"storage\")#") }}
                    <div class="color-highlight size-h3">{{ $storage_available }}/{{ $storage_total }}</div>
                    <div class="size-h5 uppercase">Storage</div>
                </div>
              </div>
            </div>

        - type: custom-api
          title: Server Stats
          title-url: https://monitoring.shubhamprasad.me
          cache: 5m
          options:
            base-url: https://monitoring.shubhamprasad.me
            api-key: ${BESZEL_TOKEN}
            collapseAfter: 2
          template: |
            {{/* Required config options */}}
            {{ $baseURL := .Options.StringOr "base-url" "" }}
            {{ $apiKey := .Options.StringOr "api-key" "" }}
            {{ define "errorMsg" }}
              <div class="widget-error-header">
                <div class="color-negative size-h3">ERROR</div>
                <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                </svg>
              </div>
              <p class="break-all">{{ . }}</p>
            {{ end }}
            {{ define "formatGigabytes" }}
              {{ $value := . }}
              {{ $label := "GB" }}
              {{- if lt $value 1.0 }}
                {{ $value = mul $value 1000.0 }}
                {{ $label = "MB" }}
              {{- else if lt $value 1000.0 }}
              {{ else }}
                {{ $value = div $value 1000.0 }}
                {{ $label = "TB" }}
              {{ end }}
              {{ printf "%.1f" $value }} <span class="color-base size-h5">{{ $label }}</span>
            {{ end }}
            {{ if or (eq $baseURL "") (eq $apiKey "") }}
              {{ template "errorMsg" "Some required options are not set." }}
            {{ else }}
              {{ $token := concat "Bearer " $apiKey }}
              {{ $systemsResponse := newRequest (print $baseURL "/api/collections/systems/records")
                  | withHeader "Authorization" $token
                  | getResponse }}
              {{ $systems := $systemsResponse.JSON.Array "items" }}
              <style>
                .server-stats-item {
                  margin-top: 1rem; 
                  border-top: 1px solid var(--color-separator);
                  padding-top: 1rem;
                }
                .server-stats-item:first-child {
                  margin-top: 0;
                  border-top: none;
                  padding-top: 0;
                }
              </style>
              <div class="collapsible-container" data-collapse-after="{{ .Options.IntOr "collapseAfter" 1 }}">
              {{ range $n, $system := $systems }}
                <div class="server-stats-item">
                {{ $status := $system.String "status" }}
                {{ $systemStatsRequest := newRequest (print $baseURL "/api/collections/system_stats/records")
                    | withHeader "Authorization" $token
                    | withParameter "sort" "-created"
                    | withParameter "page" "1"
                    | withParameter "perPage" "1"
                    | withParameter "filter" (print "type='1m'&&system='" ($system.String "id") "'")
                    | getResponse }}
                {{ $systemStatItems := $systemStatsRequest.JSON.Array "items" }}
                {{ $hostname := $system.String "name" }}
                {{ $uptimeSec := $system.Float "info.u" }}
                {{ $systemTemp := $system.Float "info.dt"}}
                {{ $cpuLoad := $system.Float "info.cpu" }}
                {{ $cpuLoad1m := $system.Float "info.l1" }}
                {{ $cpuLoad15m := $system.Float "info.l15" }}
                {{ $memoryUsedPercent := $system.Float "info.mp" }}
                {{ $rootUsedPercent := $system.Float "info.dp" }}
                {{ $hasStats := false }}
                {{ $systemStats := "" }}
                {{ $memoryTotalGb := 0.0 }}
                {{ $memoryUsedGb := 0.0 }}
                {{ $swapTotalGb := 0.0 }} 
                {{ $swapUsedGb := 0.0 }}
                {{ $swapUsedPercent := 0.0 }}
                {{ $rootTotalGb := 0.0 }}
                {{ $rootUsedGb := 0.0 }}
                {{ if gt (len $systemStatItems) 0 }}
                  {{ $hasStats = true }}
                  {{ $systemStats = index $systemStatItems 0 }}
                  {{ $memoryTotalGb = $systemStats.Float "stats.m" }}
                  {{ $memoryUsedGb = $systemStats.Float "stats.mu" }}
                  {{ $swapTotalGb = $systemStats.Float "stats.s" }}
                  {{ $swapUsedGb = $systemStats.Float "stats.su" }}
                  {{ $swapUsedPercent = mul (div $swapUsedGb $swapTotalGb) 100.0 }}
                  {{ $rootTotalGb = $systemStats.Float "stats.d" }}
                  {{ $rootUsedGb = $systemStats.Float "stats.du" }}
                {{ end }}
                <div class="server">
                  <div class="server-info">
                    <div class="server-details">
                      <div class="server-name color-highlight size-h3">{{ $hostname }}</div>
                      <div>
                        {{ if eq $status "up" }}
                          <span>{{ printf "%.1f" (mul $uptimeSec 0.000011574) }}d</span> uptime
                        {{ else }}
                          unreachable
                        {{ end }}
                      </div>
                    </div>
                    <div class="shrink-0"{{ if eq $status "up" }} data-popover-type="html" data-popover-margin="0.2rem" data-popover-max-width="400px"{{ end }}>
                      {{- if eq $status "up" }}
                      <div data-popover-html>
                        <div class="flex">
                          <div class="size-h5 text-compact">Kernel</div>
                          <div class="value-separator"></div>
                          <div class="color-highlight">{{ $system.String "info.k" }}</div>
                        </div>
                        <div class="flex">
                          <div class="size-h5 text-compact">CPU</div>
                          <div class="value-separator"></div>
                          <div class="color-highlight">{{ $system.String "info.m" }}</div>
                        </div>
                      </div>
                      {{- end }}
                      <svg class="server-icon" stroke="var(--color-{{ if eq $status "up" }}positive{{ else }}negative{{ end }})" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z" />
                      </svg>
                    </div>
                  </div>
                  <div class="server-stats">
                    <div class="flex-1">
                      <div class="flex items-end size-h5">
                        <div>CPU</div>
                        {{- if ge $systemTemp 80.0 }}
                        <svg class="server-spicy-cpu-icon" fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" >
                          <path fill-rule="evenodd" d="M8.074.945A4.993 4.993 0 0 0 6 5v.032c.004.6.114 1.176.311 1.709.16.428-.204.91-.61.7a5.023 5.023 0 0 1-1.868-1.677c-.202-.304-.648-.363-.848-.058a6 6 0 1 0 8.017-1.901l-.004-.007a4.98 4.98 0 0 1-2.18-2.574c-.116-.31-.477-.472-.744-.28Zm.78 6.178a3.001 3.001 0 1 1-3.473 4.341c-.205-.365.215-.694.62-.59a4.008 4.008 0 0 0 1.873.03c.288-.065.413-.386.321-.666A3.997 3.997 0 0 1 8 8.999c0-.585.126-1.14.351-1.641a.42.42 0 0 1 .503-.235Z" clip-rule="evenodd" />
                        </svg>
                        {{- end }}
                        <div class="color-highlight margin-left-auto text-very-compact">{{ $cpuLoad }} <span class="color-base">%</span></div>
                      </div>
                      <div data-popover-type="html">
                        <div data-popover-html>
                          <div class="flex">
                            <div class="size-h5">1M AVG</div>
                            <div class="value-separator"></div>
                            <div class="color-highlight text-very-compact">{{ printf "%.1f" $cpuLoad1m }} <span class="color-base size-h5">%</span></div>
                          </div>
                          <div class="flex margin-top-3">
                            <div class="size-h5">15M AVG</div>
                            <div class="value-separator"></div>
                            <div class="color-highlight text-very-compact">{{ printf "%.1f" $cpuLoad15m }} <span class="color-base size-h5">%</span></div>
                          </div>
                          <div class="flex margin-top-3">
                            <div class="size-h5">TEMP C</div>
                            <div class="value-separator"></div>
                            <div class="color-highlight text-very-compact">{{ printf "%.1f" $systemTemp }} <span class="color-base size-h5">°</span></div>
                          </div>
                        </div>
                        <div class="progress-bar progress-bar-combined">
                          <div class="progress-value{{ if ge $cpuLoad1m 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $cpuLoad1m }}"></div>
                          <div class="progress-value{{ if ge $cpuLoad15m 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $cpuLoad15m }}"></div>
                        </div>
                      </div>
                    </div>
                    <div class="flex-1">
                      <div class="flex justify-between items-end size-h5">
                        <div>RAM</div>
                        <div class="color-highlight text-very-compact">{{ $memoryUsedPercent }} <span class="color-base">%</span></div>
                      </div>
                      <div data-popover-type="html">
                        {{- if $hasStats }}
                        <div data-popover-html>
                          <div class="flex">
                            <div class="size-h5">RAM</div>
                            <div class="value-separator"></div>
                            <div class="color-highlight text-very-compact">
                              {{ template "formatGigabytes" $memoryUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $memoryTotalGb }}
                            </div>
                          </div> 
                          {{- if gt $swapTotalGb 0.0 }}
                          <div class="flex margin-top-3">
                            <div class="size-h5">SWAP</div>
                            <div class="value-separator"></div>
                            <div class="color-highlight text-very-compact">
                              {{ template "formatGigabytes" $swapUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $swapTotalGb }}
                            </div>
                          </div>
                          {{- end }}
                        </div>
                        {{- end }}
                        <div class="progress-bar progress-bar-combined">
                          <div class="progress-value{{ if ge $memoryUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $memoryUsedPercent }}"></div>
                          {{- if gt $swapTotalGb 0.0 }}
                          <div class="progress-value{{ if ge $swapUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $swapUsedPercent }}"></div>
                          {{- end }}
                        </div>
                      </div>
                    </div>
                    <div class="flex-1">
                      <div class="flex justify-between items-end size-h5">
                        <div>DISK</div>
                        <div class="color-highlight text-very-compact">{{ $rootUsedPercent }} <span class="color-base">%</span></div>
                      </div>
                      <div data-popover-type="html">
                        {{- if $hasStats }}
                        <div data-popover-html>
                          <ul class="list list-gap-2">
                            <li class="flex">
                              <div class="size-h5">/</div>
                              <div class="value-separator"></div>
                              <div class="color-highlight text-very-compact">
                                {{ template "formatGigabytes" $rootUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $rootTotalGb }}
                              </div>
                            </li>
                              {{ range $key, $efs := ($systemStats.Get "stats.efs").Map }}
                                <li class="flex">
                                  <div class="size-h5">{{ $key }}</div>
                                  <div class="value-separator"></div>
                                  <div class="color-highlight text-very-compact">
                                    {{ template "formatGigabytes" (($efs.Get "du").Float) }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" (($efs.Get "d").Float) }}
                                  </div>
                                </li>
                              {{ end }}
                          </ul>
                        </div>
                        {{- end }}
                        <div class="progress-bar progress-bar-combined">
                          <div class="progress-value{{ if ge $rootUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $rootUsedPercent }}"></div>
                          {{ range $key, $efs := ($system.Get "info.efs").Map }}
                            {{ $percent := $efs.Float }}
                            <div class="progress-value{{ if ge $percent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $percent }}"></div>
                          {{ end }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              {{ end }}
              </div>
              <script>
                (function() {
                    const containers = document.querySelectorAll('.collapsible-container');
                    containers.forEach(container => {
                        if (container.dataset.initialized) return;
                        const limit = parseInt(container.dataset.collapseAfter || '100');
                        const items = container.children;
                        if (items.length > limit) {
                            for(let i = limit; i < items.length; i++) {
                                items[i].style.display = 'none';
                            }
                            const btn = document.createElement('div');
                            btn.className = 'button button-outline margin-top-2 full-width';
                            btn.textContent = 'Show ' + (items.length - limit) + ' more';
                            btn.onclick = function() {
                                const isHidden = items[limit].style.display === 'none';
                                for(let i = limit; i < items.length; i++) {
                                    items[i].style.display = isHidden ? '' : 'none';
                                }
                                btn.textContent = isHidden ? 'Show Less' : 'Show ' + (items.length - limit) + ' more';
                            };
                            container.parentElement.appendChild(btn);
                        }
                        container.dataset.initialized = 'true';
                    });
                })();
              </script>
            {{ end }}

        - type: custom-api
          title: What's Up Docker
          title-url: https://wud.shubhamprasad.me
          cache: 1m
          url: http://${WUD_URL}/api/containers
          options:
            collapseAfter: 2
          template: |
            <style>
              .widget-type-wud li {
                margin-top: var(--list-half-gap); 
                border-top: 1px solid var(--color-separator);
                padding-top: var(--list-half-gap);
              }
            </style>
            <ul class="list list-gap-10 collapsible-container widget-type-wud" data-collapse-after="{{ .Options.IntOr "collapseAfter" 3 }}">
              {{ range .JSON.Array "" }}
              <li class="flex items-center gap-10">
                <div class="grow">
                   <div class="size-h4 block text-truncate color-highlight">
                    {{ .String "displayName" }}
                   </div>
                   <div class="size-h6">
                    {{ .String "status" }}
                   </div>
                </div>
                {{ if .Bool "updateAvailable" }}
                <div class="color-negative size-h4">Update</div>
                {{ else }}
                <div class="color-positive size-h4">Latest</div>
                {{ end }}
              </li>
              {{ end }}
            </ul>
            <script>
            // Simple script to handle collapse if main script doesn't
            (function() {
                const containers = document.querySelectorAll('.collapsible-container');
                containers.forEach(container => {
                    if (container.dataset.initialized) return;
                    const limit = parseInt(container.dataset.collapseAfter || '100');
                    const items = container.children;
                    if (items.length > limit) {
                        for(let i = limit; i < items.length; i++) {
                            items[i].style.display = 'none';
                        }
                        const btn = document.createElement('div');
                        btn.className = 'button button-outline margin-top-2 full-width';
                        btn.textContent = 'Show ' + (items.length - limit) + ' more';
                        btn.onclick = function() {
                            const isHidden = items[limit].style.display === 'none';
                            for(let i = limit; i < items.length; i++) {
                                items[i].style.display = isHidden ? '' : 'none';
                            }
                            btn.textContent = isHidden ? 'Show Less' : 'Show ' + (items.length - limit) + ' more';
                        };
                        container.parentElement.appendChild(btn);
                    }
                    container.dataset.initialized = 'true';
                });
            })();
            </script>

